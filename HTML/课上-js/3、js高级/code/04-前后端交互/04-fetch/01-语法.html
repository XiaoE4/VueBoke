<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button id="myget">get</button>
    <button id="mypost">post</button>
    <button id="myput">put</button>
    <button id="mypatch">patch</button>
    <button id="mydelete">delete</button>

    <script>
        myget.onclick= function(){
            // ajax({
            // url:"http://localhost:3000/users",
            // // data:{
            // //     "username":"adc",
            // //     "age":18
            // // },
            // success:function(res){
            //     console.log("success",res);
            // },
            // error:function(err){
            //     console.log("error",err);
            // }
        // })
        var username="xiaoE"
        fetch(`http://localhost:3000/users?username=${username}`)
        .then(res=>{
            console.log(res);
            // 把数据按照json类型读出来
            if(res.ok){
                return res.json()
            }else{
                // 拒绝
                return Promise.reject({
                    a:1,
                    status:res.status,
                    statusText:res.statusText
                })
            }
            // 默认这个then执行完后直接执行下一个then，无论这个then是否是错误的
        })   
        // 简化为：
        // .then(res=>res.json())  //res.json() res.text()
        .then(res=>{
            console.log("success",res);
        }).catch(err=>{
            console.log("error",err);
        })          //默认不会走catch，所以要让res拒绝承诺
        
            
        }
        mypost.onclick= function(){
        //     ajax({
        //     url:"http://localhost:3000/users",
        //     method:"POST",
        //     data:{
        //         "username":"xiaoming",
        //         "password":"456"
        //     },
        //     headers:{
        //         "content-type":"application/x-www-form-urlencoded"
        //         // "content-type":"application/json"
        //     },
        //     success:function(res){
        //         console.log("success",res);
        //     },
        //     error:function(err){
        //         console.log("error",err);
        //     }
        // })

            fetch("http://localhost:3000/users",{
                method:"POST",
                headers:{
                    // "content-type":"application/x-www-form-urlencoded"
                    "content-type":"application/json"
                },
                // body:"username=tiechui&password=321"
                body:JSON.stringify({
                    username:"xigema",
                    password:"234"
                })
            })
            .then(res=>res.json())
            .then(res=>{
                console.log(res);
            })

        }
        myput.onclick= function(){
        //     ajax({
        //     url:"http://localhost:3000/users/1",
        //     method:"PUT",
        //     data:{
        //         "username":"xiaoE",
        //         "password":"123456"
        //     },
        //     headers:{
        //         "content-type":"application/json"
        //     },
        //     success:function(res){
        //         console.log("success",res);
        //     },
        //     error:function(err){
        //         console.log("error",err);
        //     }
        // })
        fetch("http://localhost:3000/users/2",{
                method:"PUT",
                headers:{
                    "content-type":"application/json"
                },
                body:JSON.stringify({
                    username:"yuanshi",
                    // password:"234"
                })
            })
            .then(res=>res.json())
            .then(res=>{
                console.log(res);
            })
        

        }
        mypatch.onclick= function(){
        //     ajax({
        //     url:"http://localhost:3000/users/1",
        //     method:"PATCH",
        //     data:{
        //         "username":"xiaoE11111",
        //     },
        //     headers:{
        //         "content-type":"application/json"
        //     },
        //     success:function(res){
        //         console.log("success",res);
        //     },
        //     error:function(err){
        //         console.log("error",err);
        //     }
        // })
        fetch("http://localhost:3000/users/2",{
                method:"PATCH",
                headers:{
                    "content-type":"application/json"
                },
                body:JSON.stringify({
                    username:"yuanshi",
                    // password:"234"
                })
            })
            .then(res=>res.json())
            .then(res=>{
                console.log(res);
            })
        }
        mydelete.onclick= function(){
        //     ajax({
        //     url:"http://localhost:3000/users/4",
        //     method:"DELETE",
        //     success:function(res){
        //         console.log("success",res);
        //     },
        //     error:function(err){
        //         console.log("error",err);
        //     }
        // })
        fetch("http://localhost:3000/users/2",{
                method:"delete",
            })
            .then(res=>res.json())
            .then(res=>{
                console.log(res);
            })
        }
        



    </script>
</body>
</html>